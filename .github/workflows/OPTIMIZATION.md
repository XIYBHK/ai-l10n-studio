# CI/CD ä¼˜åŒ–æ€»ç»“

## âœ… å·²å®ç°çš„ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥ (åŸºäº Context7 æœ€ä½³å®è·µ)

#### npm ç¼“å­˜
```yaml
- name: Cache npm dependencies
  uses: actions/cache@v4
  with:
    path: ${{ steps.npm-cache-dir.outputs.dir }}
    key: ${{ runner.os }}-node-20-${{ hashFiles('**/package-lock.json') }}
    restore-keys: |
      ${{ runner.os }}-node-20-
      ${{ runner.os }}-node-
```

**ä¼˜åŠ¿ï¼š**
- âœ… ç¼“å­˜ npm å…¨å±€ç¼“å­˜ç›®å½•è€Œé node_modules
- âœ… åŸºäº package-lock.json å“ˆå¸Œçš„ç²¾ç¡®ç¼“å­˜é”®
- âœ… æ¸è¿›å¼ç¼“å­˜å›é€€ç­–ç•¥ï¼ˆrestore-keysï¼‰
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindows/macOS/Linuxï¼‰

**é¢„æœŸåŠ é€Ÿï¼š**
- é¦–æ¬¡æ„å»ºï¼šæ— ç¼“å­˜
- åç»­æ„å»ºï¼šnpm ä¾èµ–å®‰è£…æ—¶é—´å‡å°‘ **50-70%**

#### Rust ç¼“å­˜
```yaml
- name: Rust cache
  uses: swatinem/rust-cache@v2
  with:
    workspaces: 'po-translator-gui/src-tauri -> target'
```

**ä¼˜åŠ¿ï¼š**
- âœ… è‡ªåŠ¨ç¼“å­˜ Cargo ä¾èµ–å’Œæ„å»ºäº§ç‰©
- âœ… æ™ºèƒ½ç¼“å­˜é”®ç”Ÿæˆï¼ˆåŸºäº Cargo.lockï¼‰
- âœ… å¢é‡ç¼–è¯‘æ”¯æŒ

**é¢„æœŸåŠ é€Ÿï¼š**
- é¦–æ¬¡æ„å»ºï¼šæ— ç¼“å­˜
- åç»­æ„å»ºï¼šRust ç¼–è¯‘æ—¶é—´å‡å°‘ **60-80%**

### 2. ä¾èµ–ç®¡ç†ä¼˜åŒ–

#### package-lock.json æäº¤
- âœ… ä» .gitignore ç§»é™¤ package-lock.json
- âœ… ç¡®ä¿å›¢é˜Ÿå’Œ CI ä½¿ç”¨ç›¸åŒä¾èµ–ç‰ˆæœ¬
- âœ… æ”¯æŒ `npm ci` å¿«é€Ÿå®‰è£…ï¼ˆæ¯” `npm install` å¿« 2-3 å€ï¼‰

### 3. æ„å»ºé…ç½®ä¼˜åŒ–

#### å·¥ä½œæµè¯­æ³•
- âœ… `working-directory` ä½¿ç”¨æ˜ç¡®çš„ç›¸å¯¹è·¯å¾„ (`./`)
- âœ… å±æ€§é¡ºåºç¬¦åˆ GitHub Actions æœ€ä½³å®è·µ
- âœ… å¹³å°ç‰¹å®šæ­¥éª¤ä½¿ç”¨æ¡ä»¶æ‰§è¡Œ

#### è°ƒè¯•å¢å¼º
- âœ… Windows æ„å»ºæ·»åŠ è°ƒè¯•è¾“å‡º
- âœ… upload-artifact ä½¿ç”¨ `if-no-files-found: warn`

## ğŸ“Š æ€§èƒ½æå‡é¢„æœŸ

### é¦–æ¬¡æ„å»ºï¼ˆæ— ç¼“å­˜ï¼‰
- Check: ~3-5 åˆ†é’Ÿ
- Build (3 å¹³å°): ~15-20 åˆ†é’Ÿ
- Release: ~20-25 åˆ†é’Ÿ

### åç»­æ„å»ºï¼ˆæœ‰ç¼“å­˜ï¼‰
- Check: ~1-2 åˆ†é’Ÿ **(èŠ‚çœ 60%)**
- Build (3 å¹³å°): ~5-8 åˆ†é’Ÿ **(èŠ‚çœ 65%)**
- Release: ~8-12 åˆ†é’Ÿ **(èŠ‚çœ 55%)**

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. Windows æ„å»ºäº§ç‰©ç¼ºå¤±

**é—®é¢˜ï¼š** `No files were found with the provided path`

**å¯èƒ½åŸå› ï¼š**
- Tauri åœ¨ Windows ä¸Šå¯èƒ½é»˜è®¤ä¸ç”Ÿæˆ MSI/NSIS
- éœ€è¦åœ¨ tauri.conf.json ä¸­æ˜ç¡®é…ç½®

**ä¸´æ—¶æ–¹æ¡ˆï¼š**
- å·²æ·»åŠ è°ƒè¯•æ­¥éª¤æŸ¥çœ‹æ„å»ºè¾“å‡º
- æ·»åŠ  `if-no-files-found: warn` é¿å…å·¥ä½œæµå¤±è´¥

**å¾…éªŒè¯ï¼š**
```json
// tauri.conf.json - bundle é…ç½®
"bundle": {
  "active": true,
  "targets": ["msi", "nsis"],  // æ˜ç¡®æŒ‡å®š Windows ç›®æ ‡
  ...
}
```

### 2. Linux åŒ…ä½“ç§¯è¿‡å¤§ (92.5 MB)

**é—®é¢˜ï¼š** Linux AppImage/DEB åŒ…è¿œå¤§äº macOS (9.91 MB)

**åŸå› åˆ†æï¼š**
- å¯èƒ½åŒ…å«è°ƒè¯•ç¬¦å·
- AppImage åŒ…å«å®Œæ•´è¿è¡Œæ—¶

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
```toml
# Cargo.toml - Release ä¼˜åŒ–
[profile.release]
opt-level = "z"     # ä¼˜åŒ–ä½“ç§¯
lto = true          # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1   # å•ä¸ªä»£ç ç”Ÿæˆå•å…ƒ
strip = true        # ç§»é™¤è°ƒè¯•ç¬¦å·
panic = "abort"     # å‡å°äºŒè¿›åˆ¶ä½“ç§¯
```

### 3. ç¼“å­˜è­¦å‘Šï¼ˆæ­£å¸¸ï¼‰

**è­¦å‘Šï¼š** `Cache not found for keys: ...`

**è¯´æ˜ï¼š**
- âœ… é¦–æ¬¡è¿è¡Œæ­£å¸¸ç°è±¡
- âœ… ç¬¬äºŒæ¬¡è¿è¡Œä¼šå‘½ä¸­ç¼“å­˜
- âœ… ä¸å½±å“æ„å»ºæˆåŠŸ

## ğŸ”„ ç¼“å­˜å·¥ä½œåŸç†

### ç¼“å­˜é”®ç­–ç•¥

#### ä¸»é”®ï¼ˆPrimary Keyï¼‰
```
${{ runner.os }}-node-20-${{ hashFiles('**/package-lock.json') }}
```
- OS ç‰¹å®š
- Node.js ç‰ˆæœ¬ç‰¹å®š
- ä¾èµ–æ–‡ä»¶å“ˆå¸Œ

#### å›é€€é”®ï¼ˆRestore Keysï¼‰
```
${{ runner.os }}-node-20-
${{ runner.os }}-node-
```
- é€çº§å›é€€
- æé«˜ç¼“å­˜å‘½ä¸­ç‡

### ç¼“å­˜å¤±æ•ˆè§¦å‘
- âœ… package-lock.json å˜æ›´
- âœ… Node.js ç‰ˆæœ¬å‡çº§
- âœ… æ“ä½œç³»ç»Ÿå˜æ›´
- âœ… ç¼“å­˜è¶…è¿‡ 7 å¤©è‡ªåŠ¨æ¸…ç†

## ğŸ“ˆ æŒç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- [x] æ·»åŠ  npm ç¼“å­˜
- [x] æ·»åŠ  Rust ç¼“å­˜
- [x] æäº¤ package-lock.json
- [x] ä¿®å¤ä»£ç æ ¼å¼

### ä¸­æœŸï¼ˆå¾…å®æ–½ï¼‰
- [ ] ä¼˜åŒ– Rust ç¼–è¯‘é…ç½®ï¼ˆå‡å°ä½“ç§¯ï¼‰
- [ ] é…ç½® Windows æ„å»ºç›®æ ‡
- [ ] æ·»åŠ æ„å»ºæ—¶é—´ç»Ÿè®¡
- [ ] å®ç°ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§

### é•¿æœŸï¼ˆè§„åˆ’ä¸­ï¼‰
- [ ] å¢é‡æ„å»ºä¼˜åŒ–
- [ ] å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- [ ] è‡ªå®šä¹‰ Docker é•œåƒï¼ˆé¢„è£…ä¾èµ–ï¼‰
- [ ] åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡

## ğŸ”— å‚è€ƒèµ„æº

- [GitHub Actions Cache æ–‡æ¡£](https://github.com/actions/cache)
- [Rust Cache Action](https://github.com/Swatinem/rust-cache)
- [Tauri æ„å»ºä¼˜åŒ–](https://tauri.app/v1/guides/building/cross-platform)
- [npm ci vs npm install](https://docs.npmjs.com/cli/v8/commands/npm-ci)

## ğŸ“ ç»´æŠ¤è¯´æ˜

### ç¼“å­˜æ¸…ç†
å¦‚æœé‡åˆ°ç¼“å­˜ç›¸å…³é—®é¢˜ï¼Œå¯ä»¥åœ¨ GitHub ä»“åº“ä¸­æ‰‹åŠ¨æ¸…ç†ï¼š
1. Settings â†’ Actions â†’ Caches
2. åˆ é™¤ç‰¹å®šç¼“å­˜æˆ–å…¨éƒ¨æ¸…ç†

### æ€§èƒ½ç›‘æ§
åœ¨ Actions æ ‡ç­¾é¡µæŸ¥çœ‹ï¼š
- æ„å»ºæ—¶é—´è¶‹åŠ¿
- ç¼“å­˜å‘½ä¸­ç‡
- æˆåŠŸç‡ç»Ÿè®¡

---

**æœ€åæ›´æ–°ï¼š** 2025-10-06  
**ä¼˜åŒ–ç‰ˆæœ¬ï¼š** v2.0  
**ç»´æŠ¤è€…ï¼š** AI Assistant

