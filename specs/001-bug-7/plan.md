# Implementation Plan: å…³é”®ç”¨æˆ·ç•Œé¢å’ŒåŠŸèƒ½é—®é¢˜ä¿®å¤

**Branch**: `001-bug-7` | **Date**: 2025-10-14 | **Spec**: [spec.md](./spec.md)  
**Input**: Feature specification from `/specs/001-bug-7/spec.md`

## Summary

ä¿®å¤7ä¸ªå…³é”®çš„ç”¨æˆ·ç•Œé¢å’ŒåŠŸèƒ½é—®é¢˜ï¼ŒåŒ…æ‹¬3ä¸ªP1é˜»å¡æ€§é—®é¢˜ï¼ˆAIé…ç½®ä¿å­˜å¤±è´¥ã€ç³»ç»Ÿæç¤ºè¯ä¿å­˜å¤±è´¥ã€è¯­è¨€æ£€æµ‹å¤±è´¥ï¼‰ã€2ä¸ªP2ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼ˆä¸»é¢˜åˆ‡æ¢å“åº”ã€å¤–è§‚è®¾ç½®åŠŸèƒ½ï¼‰ã€1ä¸ªP3æ”¹è¿›é¡¹ï¼ˆæ—¥å¿—ç®¡ç†ï¼‰ã€‚

**æŠ€æœ¯æ–¹æ³•**: 
- å‰ç«¯å‚æ•°åºåˆ—åŒ–ä¿®æ­£ï¼ˆAIé…ç½®ä¿å­˜ï¼‰
- å‘½ä»¤åç§°å’Œå‚æ•°æ ¼å¼å¯¹é½ï¼ˆç³»ç»Ÿæç¤ºè¯ã€è¯­è¨€æ£€æµ‹ï¼‰
- çŠ¶æ€ç®¡ç†ä¼˜åŒ–ï¼ˆä¸»é¢˜åˆ‡æ¢ï¼‰
- ç³»ç»ŸAPIé›†æˆï¼ˆè·Ÿéšç³»ç»Ÿä¸»é¢˜ã€è¯­è¨€åˆ‡æ¢ã€æ‰“å¼€æ—¥å¿—ç›®å½•ï¼‰

## Technical Context

**Language/Version**: 
- Frontend: TypeScript 5.3 + React 18
- Backend: Rust Edition 2024

**Primary Dependencies**: 
- Frontend: Ant Design 5, Zustand (state), SWR (cache)
- Backend: Tauri 2.8, Tokio (async), serde (serialization)

**Storage**: JSON æ–‡ä»¶ï¼ˆé…ç½®ã€ç¿»è¯‘è®°å¿†ï¼‰+ Tauri Storeï¼ˆç”¨æˆ·åå¥½ï¼‰

**Testing**: 
- Frontend: Vitest (73 tests, 82.8% coverage)
- Backend: cargo test + nextest

**Target Platform**: è·¨å¹³å°æ¡Œé¢åº”ç”¨ï¼ˆWindows 10+, macOS 10.14+, Linuxï¼‰

**Project Type**: Desktop (Tauri hybrid architecture - Rust backend + React frontend)

**Performance Goals**: 
- é…ç½®ä¿å­˜æ“ä½œ < 100ms
- ä¸»é¢˜åˆ‡æ¢ < 100ms
- è¯­è¨€åˆ‡æ¢ < 1s
- UI å“åº”æ—¶é—´ < 100ms

**Constraints**: 
- å¿…é¡»ä¿æŒå‘åå…¼å®¹ï¼ˆç°æœ‰é…ç½®æ–‡ä»¶æ ¼å¼ï¼‰
- ä¸èƒ½ç ´åç°æœ‰ç¿»è¯‘æµç¨‹
- éµå¾ªå››å±‚æ¶æ„åˆ†ç¦»åŸåˆ™

**Scale/Scope**: 
- 7ä¸ªç‹¬ç«‹BUGä¿®å¤
- æ¶‰åŠ3ä¸ªå‰ç«¯ç»„ä»¶ï¼ˆSettingsModal, MenuBar, Appï¼‰
- æ¶‰åŠ4ä¸ªåç«¯å‘½ä»¤ï¼ˆadd_ai_config, update_system_prompt, get_default_target_lang, å¾…æ–°å¢çš„ç³»ç»ŸAPIï¼‰
- é¢„è®¡ä¿®æ”¹ < 20ä¸ªæ–‡ä»¶

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### æ ¸å¿ƒåŸåˆ™åˆè§„æ€§æ£€æŸ¥

#### âœ… I. å››å±‚æ¶æ„åˆ†ç¦»
- **çŠ¶æ€**: ç¬¦åˆ
- **éªŒè¯**: ä¿®å¤é™äºå„å±‚å†…éƒ¨ï¼Œä¸å¼•å…¥è·¨å±‚è°ƒç”¨
  - é…ç½®ä¿å­˜ï¼šä¿®å¤ `SettingsModal` (ç»„ä»¶å±‚) â†’ `commands.ts` (å‘½ä»¤å±‚) â†’ Rust å‘½ä»¤
  - ä¸»é¢˜åˆ‡æ¢ï¼šä¿®å¤ `useAppStore` (çŠ¶æ€å±‚) çŠ¶æ€åŒæ­¥
  - æ— è·¨å±‚ç›´æ¥è®¿é—®

#### âœ… II. æµ‹è¯•ä¼˜å…ˆ
- **çŠ¶æ€**: ç¬¦åˆ
- **è®¡åˆ’**: 
  1. ä¸ºæ¯ä¸ªBUGç¼–å†™å¤±è´¥çš„å›å½’æµ‹è¯•
  2. ä¿®å¤ä»£ç ä½¿æµ‹è¯•é€šè¿‡
  3. æ·»åŠ è¾¹ç•Œæµ‹è¯•ï¼ˆç‰¹æ®Šå­—ç¬¦ã€å¹¶å‘ã€ç½‘ç»œé”™è¯¯ç­‰ï¼‰
- **æµ‹è¯•è¦†ç›–**: å‰ç«¯é›†æˆæµ‹è¯• + åç«¯å•å…ƒæµ‹è¯•

#### âœ… III. ç»Ÿä¸€é”™è¯¯å¤„ç†
- **çŠ¶æ€**: ç¬¦åˆï¼ˆå…³é”®æ”¹è¿›ç‚¹ï¼‰
- **è®¡åˆ’**: 
  - æ‰€æœ‰é…ç½®ä¿å­˜å¤±è´¥æ˜¾ç¤ºå…·ä½“é”™è¯¯ï¼ˆå¦‚"ç¼ºå°‘APIå¯†é’¥"è€Œé"ä¿å­˜å¤±è´¥"ï¼‰
  - åç«¯é”™è¯¯ä½¿ç”¨ `anyhow::Result` ç»Ÿä¸€æ ¼å¼
  - å‰ç«¯é€šè¿‡ `commands.ts` ç»Ÿä¸€å¤„ç†é”™è¯¯æ¶ˆæ¯

#### âœ… IV. æ— é—ç•™ä»£ç 
- **çŠ¶æ€**: ç¬¦åˆ
- **è®¡åˆ’**: 
  - åˆ é™¤æ—§çš„ `api.ts` è°ƒç”¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œç»Ÿä¸€ä½¿ç”¨ `commands.ts`
  - åˆ é™¤è°ƒè¯•ç”¨çš„ console.log
  - åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥

#### âœ… V. å•ä¸€èŒè´£åŸåˆ™
- **çŠ¶æ€**: ç¬¦åˆ
- **éªŒè¯**: æ¯ä¸ªä¿®å¤é’ˆå¯¹å•ä¸€é—®é¢˜ï¼Œä¸å¼•å…¥é¢å¤–åŠŸèƒ½

#### âœ… VI. ç±»å‹å®‰å…¨ä¼˜å…ˆ
- **çŠ¶æ€**: ç¬¦åˆ
- **è®¡åˆ’**: 
  - ç¡®ä¿å‰åç«¯ç±»å‹ä¸€è‡´ï¼ˆ`AIConfig` ç­‰ï¼‰
  - ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼æ•è·å‚æ•°é”™è¯¯
  - Rust é€šè¿‡ Clippy æ£€æŸ¥

#### âœ… VII. å°æ­¥æäº¤
- **çŠ¶æ€**: ç¬¦åˆ
- **è®¡åˆ’**: æ¯ä¸ªBUGä¿®å¤å•ç‹¬æäº¤ï¼ˆ7ä¸ªç‹¬ç«‹commitï¼‰

#### âœ… VIII. æ–‡æ¡£ç®€æ´
- **çŠ¶æ€**: ç¬¦åˆ
- **è®¡åˆ’**: å®Œæˆåä»…æ›´æ–° CHANGELOG.mdï¼Œä¸åˆ›å»ºé¢å¤–æ–‡æ¡£

### æ¶æ„çº¦æŸæ£€æŸ¥

#### âœ… æŠ€æœ¯æ ˆé”å®š
- **çŠ¶æ€**: ç¬¦åˆ
- **éªŒè¯**: ä¸å¼•å…¥æ–°ä¾èµ–ï¼Œä»…ä¿®å¤ç°æœ‰ä»£ç 

#### âœ… æ€§èƒ½æ ‡å‡†
- **çŠ¶æ€**: ç¬¦åˆ
- **ç›®æ ‡**: æ‰€æœ‰æ“ä½œå“åº”æ—¶é—´ < 100msï¼ˆç¬¦åˆæ ‡å‡†ï¼‰

### ç»“è®º
**âœ… é€šè¿‡æ‰€æœ‰ Constitution æ£€æŸ¥ï¼Œå¯ä»¥è¿›å…¥ Phase 0 ç ”ç©¶é˜¶æ®µ**

## Project Structure

### Documentation (this feature)

```
specs/001-bug-7/
â”œâ”€â”€ spec.md              # åŠŸèƒ½è§„èŒƒ
â”œâ”€â”€ plan.md              # æœ¬æ–‡ä»¶ï¼ˆå®æ–½è®¡åˆ’ï¼‰
â”œâ”€â”€ research.md          # Phase 0: æŠ€æœ¯ç ”ç©¶
â”œâ”€â”€ data-model.md        # Phase 1: æ•°æ®æ¨¡å‹ï¼ˆé…ç½®ç»“æ„ï¼‰
â”œâ”€â”€ contracts/           # Phase 1: API å¥‘çº¦
â”‚   â”œâ”€â”€ commands.md      # Tauri å‘½ä»¤æ¥å£
â”‚   â””â”€â”€ events.md        # äº‹ä»¶å®šä¹‰
â”œâ”€â”€ quickstart.md        # Phase 1: å¿«é€ŸéªŒè¯æŒ‡å—
â”œâ”€â”€ checklists/          # è´¨é‡æ£€æŸ¥æ¸…å•
â”‚   â””â”€â”€ requirements.md  # å·²å®Œæˆ
â””â”€â”€ tasks.md             # Phase 2: è¯¦ç»†ä»»åŠ¡åˆ—è¡¨ï¼ˆå¾…åˆ›å»ºï¼‰
```

### Source Code (repository root)

```
ai-l10n-studio/
â”œâ”€â”€ src/                           # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ SettingsModal.tsx      # ğŸ”§ AIé…ç½®ã€ç³»ç»Ÿæç¤ºè¯ã€å¤–è§‚è®¾ç½®ä¿®å¤
â”‚   â”‚   â”œâ”€â”€ MenuBar.tsx            # ğŸ”§ ä¸»é¢˜åˆ‡æ¢ä¿®å¤
â”‚   â”‚   â””â”€â”€ ThemeModeSwitch.tsx    # ğŸ”§ ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useTheme.ts            # ğŸ”§ ä¸»é¢˜ç®¡ç†é€»è¾‘
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ useAppStore.ts         # ğŸ”§ ä¸»é¢˜çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ commands.ts            # ğŸ”§ å‘½ä»¤å±‚ï¼ˆç¡®ä¿å‚æ•°æ­£ç¡®ï¼‰
â”‚   â”‚   â””â”€â”€ api.ts                 # æ£€æŸ¥æ˜¯å¦æœ‰é—ç•™è°ƒç”¨
â”‚   â”œâ”€â”€ i18n/
â”‚   â”‚   â””â”€â”€ config.ts              # ğŸ”§ è¯­è¨€åˆ‡æ¢é€»è¾‘
â”‚   â””â”€â”€ App.tsx                    # ğŸ”§ è¯­è¨€æ£€æµ‹ä¿®å¤
â”‚
â”œâ”€â”€ src-tauri/                     # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ config.rs          # ğŸ”§ AIé…ç½®å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ system_prompt.rs   # ğŸ”§ ç³»ç»Ÿæç¤ºè¯å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ language.rs        # ğŸ”§ è¯­è¨€æ£€æµ‹å‘½ä»¤
â”‚   â”‚   â”‚   â””â”€â”€ system.rs          # ğŸ†• ç³»ç»ŸAPIï¼ˆæ‰“å¼€ç›®å½•ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ config_draft.rs    # ğŸ”§ é…ç½®æŒä¹…åŒ–
â”‚   â”‚   â””â”€â”€ main.rs                # æ£€æŸ¥å‘½ä»¤æ³¨å†Œ
â”‚   â””â”€â”€ Cargo.toml
â”‚
â””â”€â”€ __tests__/                     # ğŸ†• å›å½’æµ‹è¯•
    â”œâ”€â”€ bug-fixes/
    â”‚   â”œâ”€â”€ ai-config-save.test.tsx
    â”‚   â”œâ”€â”€ system-prompt-save.test.tsx
    â”‚   â”œâ”€â”€ language-detect.test.tsx
    â”‚   â”œâ”€â”€ theme-toggle.test.tsx
    â”‚   â”œâ”€â”€ appearance-settings.test.tsx
    â”‚   â””â”€â”€ log-directory.test.tsx
    â””â”€â”€ integration/
        â””â”€â”€ settings-workflow.test.tsx
```

**Structure Decision**: 
- é‡‡ç”¨ç°æœ‰çš„ **Desktop (Tauri)** æ··åˆæ¶æ„
- å‰ç«¯ï¼š`src/` ç›®å½•ï¼ŒReact ç»„ä»¶ + TypeScript
- åç«¯ï¼š`src-tauri/src/` ç›®å½•ï¼ŒRust services + commands
- æµ‹è¯•ï¼šå‰ç«¯æµ‹è¯•åœ¨ `src/__tests__/`ï¼Œåç«¯æµ‹è¯•åœ¨ `src-tauri/src/` å†…è”
- ä¸å¼•å…¥æ–°çš„ç›®å½•ç»“æ„ï¼Œéµå¾ªç°æœ‰çº¦å®š

### å…³é”®æ–‡ä»¶ä¿®å¤æ¸…å•

| ä¼˜å…ˆçº§ | é—®é¢˜ | æ¶‰åŠæ–‡ä»¶ | ä¿®æ”¹ç±»å‹ |
|--------|------|---------|---------|
| P1 | AIé…ç½®ä¿å­˜ | `src/components/SettingsModal.tsx`<br>`src/services/commands.ts`<br>`src-tauri/src/commands/config.rs` | å‚æ•°åºåˆ—åŒ–ä¿®æ­£<br>å­—æ®µéªŒè¯ |
| P1 | ç³»ç»Ÿæç¤ºè¯ä¿å­˜ | `src/components/SettingsModal.tsx`<br>`src/services/commands.ts` | å‘½ä»¤åç§°ä¿®æ­£<br>`update_system_prompt` è°ƒç”¨ |
| P1 | è¯­è¨€æ£€æµ‹å¤±è´¥ | `src/App.tsx`<br>`src/services/commands.ts`<br>`src-tauri/src/commands/language.rs` | å‚æ•°å‘½åå¯¹é½<br>`sourceLangCode` â†’ `source_lang_code` |
| P2 | ä¸»é¢˜åˆ‡æ¢ | `src/components/ThemeModeSwitch.tsx`<br>`src/store/useAppStore.ts` | çŠ¶æ€åŒæ­¥ä¿®æ­£ |
| P2 | è·Ÿéšç³»ç»Ÿä¸»é¢˜ | `src/hooks/useTheme.ts` | ç³»ç»Ÿä¸»é¢˜ç›‘å¬ |
| P2 | è¯­è¨€åˆ‡æ¢ | `src/components/SettingsModal.tsx`<br>`src/i18n/config.ts` | i18n å¼ºåˆ¶åˆ·æ–° |
| P3 | æ—¥å¿—ç›®å½•æŒ‰é’® | `src/components/SettingsModal.tsx`<br>`src-tauri/src/commands/system.rs` | UI æ·»åŠ æŒ‰é’®<br>æ–°å¢ Tauri å‘½ä»¤ |

## Complexity Tracking

*æœ¬æ¬¡ä¿®å¤æ—  Constitution è¿è§„ï¼Œæ— éœ€è®°å½•å¤æ‚åº¦è±å…ã€‚*

æ‰€æœ‰ä¿®å¤å‡ç¬¦åˆï¼š
- å››å±‚æ¶æ„åˆ†ç¦»
- ç°æœ‰æŠ€æœ¯æ ˆ
- æ€§èƒ½æ ‡å‡†
- å•ä¸€èŒè´£åŸåˆ™

---

## ä¸‹ä¸€æ­¥

1. âœ… **Phase 0**: æ‰§è¡ŒæŠ€æœ¯ç ”ç©¶ï¼ˆ`research.md`ï¼‰
2. â³ **Phase 1**: ç”Ÿæˆæ•°æ®æ¨¡å‹å’Œ API å¥‘çº¦
3. â³ **Phase 2**: åˆ›å»ºè¯¦ç»†ä»»åŠ¡åˆ—è¡¨ï¼ˆ`/speckit.tasks`ï¼‰
4. â³ **å®æ–½**: æŒ‰ä»»åŠ¡åˆ—è¡¨é€ä¸ªä¿®å¤å¹¶æµ‹è¯•
