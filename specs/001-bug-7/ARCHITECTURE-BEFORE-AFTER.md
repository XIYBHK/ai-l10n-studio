# æ¶æ„æ”¹è¿›ï¼šä»è¢«åŠ¨ä¿®å¤åˆ°ä¸»åŠ¨é¢„é˜²

## ğŸ“Š å¯¹æ¯”æ€»ç»“

### ä¿®æ”¹å‰ï¼ˆè¢«åŠ¨ï¼Œåˆ†æ•£ï¼‰

```typescript
// âŒ 18å¤„æ‰‹åŠ¨é…ç½®ï¼Œåˆ†æ•£åœ¨6ä¸ªæ–‡ä»¶ä¸­
//æ–‡ä»¶1: commands.ts
invoke(cmd1, params, { autoConvertParams: false }); // ç¬¬1å¤„
invoke(cmd2, params, { autoConvertParams: false }); // ç¬¬2å¤„
... // ç¬¬3-13å¤„

// æ–‡ä»¶2: api.ts
invoke(cmd, params, { autoConvertParams: false }); // ç¬¬14å¤„

// æ–‡ä»¶3-6: ...
// ç¬¬15-18å¤„
```

**é—®é¢˜**ï¼š

- é‡å¤ä»£ç ï¼š18å¤„ç›¸åŒçš„é…ç½®
- å®¹æ˜“é—æ¼ï¼šæ–°å¢å‘½ä»¤æ—¶å¯èƒ½å¿˜è®°æ·»åŠ 
- éš¾ä»¥ç»´æŠ¤ï¼šä¿®æ”¹è§„åˆ™éœ€è¦æ”¹18ä¸ªåœ°æ–¹
- æŠ€æœ¯å€ºåŠ¡ï¼šä»£ç å†—ä½™ï¼Œæ¶æ„ä¸æ¸…æ™°

### ä¿®æ”¹åï¼ˆä¸»åŠ¨ï¼Œé›†ä¸­ï¼‰

```typescript
// âœ… ä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ
// src/services/tauriInvoke.ts
export async function invoke<T>(...) {
  const { autoConvertParams = false } = options; // å”¯ä¸€çœŸç›¸æº
}

// å…¶ä»–æ‰€æœ‰æ–‡ä»¶ - é›¶é…ç½®
invoke(cmd, params); // è‡ªåŠ¨éµå¾ªæ¶æ„çº¦å®š
```

**ä¼˜åŠ¿**ï¼š

- é›¶é…ç½®ï¼šå¼€å‘è€…æ— éœ€å…³å¿ƒå‚æ•°è½¬æ¢
- ç»Ÿä¸€è§„èŒƒï¼šå‰åç«¯æ ¼å¼å®Œå…¨ä¸€è‡´
- æ˜“äºç»´æŠ¤ï¼šä¿®æ”¹é»˜è®¤è¡Œä¸ºåªéœ€æ”¹ä¸€å¤„
- è‡ªæˆ‘æ–‡æ¡£åŒ–ï¼šä»£ç å³æ–‡æ¡£

## ğŸ¯ æ¶æ„å‡çº§å¯¹æ¯”

| ç»´åº¦         | ä¿®æ”¹å‰       | ä¿®æ”¹å         | æ”¹è¿›        |
| ------------ | ------------ | -------------- | ----------- |
| **ä»£ç è¡Œæ•°** | +18è¡Œå†—ä½™    | -18è¡Œå†—ä½™      | å‡å°‘36è¡Œ    |
| **é…ç½®ç‚¹**   | 18å¤„åˆ†æ•£     | 1å¤„é›†ä¸­        | -94%        |
| **æ–‡ä»¶æ•°**   | 6ä¸ª          | 2ä¸ªæ ¸å¿ƒ        | -67%        |
| **å¼€å‘ä½“éªŒ** | æ‰‹åŠ¨é…ç½®     | é›¶é…ç½®         | âœ… è‡ªåŠ¨åŒ–   |
| **å¯ç»´æŠ¤æ€§** | éš¾           | æ˜“             | âœ… å•ç‚¹ä¿®æ”¹ |
| **é”™è¯¯é£é™©** | é«˜ï¼ˆæ˜“é—æ¼ï¼‰ | ä½ï¼ˆè‡ªåŠ¨æ­£ç¡®ï¼‰ | âœ… é˜²é”™     |
| **æ¶æ„æ–‡æ¡£** | æ—            | 3ç¯‡            | âœ… å®Œå–„     |

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ¶æ„æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

1. **`src/services/tauriInvoke.ts`**
   - ä¿®æ”¹é»˜è®¤å€¼ï¼š`autoConvertParams = false`
   - æ·»åŠ æ¶æ„è¯´æ˜æ³¨é‡Š
   - æä¾›ç±»å‹å®‰å…¨çš„æ¥å£

2. **`src/services/apiClient.ts`**
   - ç§»é™¤ç¡¬ç¼–ç é»˜è®¤å€¼
   - å‚æ•°é€ä¼ ç»™ `tauriInvoke`
   - ä¿æŒå‘åå…¼å®¹æ€§

### æ¸…ç†çš„æ–‡ä»¶ï¼ˆ6ä¸ªï¼‰

1. **`src/services/commands.ts`**
   - ç§»é™¤ 13å¤„ `autoConvertParams: false`
   - ä¿ç•™ camelCase æ ¼å¼è¯´æ˜æ³¨é‡Š
   - ä»£ç æ›´æ¸…æ™°æ˜“è¯»

2. **`src/services/api.ts`**
   - ç§»é™¤ 1å¤„æ‰‹åŠ¨é…ç½®
   - ä¾èµ–é»˜è®¤è¡Œä¸º

3. **`src/hooks/useChannelTranslation.ts`**
   - ç§»é™¤ 1å¤„é…ç½®
   - Channel API è‡ªåŠ¨æ­£ç¡®

4. **`src/services/swr.ts`**
   - ç§»é™¤ 2å¤„é…ç½®
   - SWR fetcher ç»Ÿä¸€è¡Œä¸º

5. **`src/services/configSync.ts`**
   - ç§»é™¤ 1å¤„é…ç½®
   - é…ç½®åŒæ­¥ç®€åŒ–

6. **`src/components/DevToolsModal.tsx`**
   - ä¿®å¤ TypeScript ç±»å‹é”™è¯¯
   - æé«˜ç±»å‹å®‰å…¨æ€§

### åç«¯ç»“æ„ä½“æ”¹è¿›ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

1. **`src-tauri/src/services/ai_translator.rs`**
   - `AIConfig`, `ProxyConfig` æ·»åŠ  `#[serde(rename_all = "camelCase")]`

2. **`src-tauri/src/services/config_manager.rs`**
   - `AppConfig`, `ConfigVersionInfo` æ·»åŠ æ³¨è§£

3. **`src-tauri/src/commands/ai_config.rs`**
   - `TestConnectionRequest`, `TestConnectionResult` æ·»åŠ æ³¨è§£

4. **`src-tauri/src/commands/translator.rs`**
   - `ContextualRefineRequest` æ·»åŠ æ³¨è§£

### æ–°å¢æ–‡æ¡£ï¼ˆ3ä¸ªï¼‰

1. **`docs/ARCHITECTURE_DECISION_TAURI_PARAMS.md`**
   - è®°å½•æ¶æ„å†³ç­–èƒŒæ™¯
   - æä¾›æœ€ä½³å®è·µæŒ‡å—
   - åˆ—å‡ºéªŒè¯æ¸…å•

2. **`specs/001-bug-7/ARCHITECTURE-IMPROVEMENT-SUMMARY.md`**
   - è¯¦ç»†è¯´æ˜æ”¹è¿›è¿‡ç¨‹
   - å¯¹æ¯”å‰åå·®å¼‚
   - æ€»ç»“ç»éªŒæ•™è®­

3. **`specs/001-bug-7/CLEANUP_PLAN.md`**
   - æ¸…ç†è®¡åˆ’å’Œè¿›åº¦è·Ÿè¸ª
   - éªŒè¯æ­¥éª¤

## ğŸ” ä»£ç ç¤ºä¾‹å¯¹æ¯”

### ç¤ºä¾‹1ï¼šAIé…ç½®æ·»åŠ 

**ä¿®æ”¹å‰**ï¼š

```typescript
// src/services/commands.ts
async add(config: AIConfig) {
  return invoke<string>(
    COMMANDS.AI_CONFIG_ADD,
    { config },
    {
      errorMessage: 'æ·»åŠ AIé…ç½®å¤±è´¥',
      autoConvertParams: false, // âŒ æ¯ä¸ªå‘½ä»¤éƒ½è¦æ‰‹åŠ¨é…ç½®
    }
  );
}
```

**ä¿®æ”¹å**ï¼š

```typescript
// src/services/commands.ts
async add(config: AIConfig) {
  return invoke<string>(
    COMMANDS.AI_CONFIG_ADD,
    { config }, // âœ… è‡ªåŠ¨ä½¿ç”¨ camelCaseï¼Œæ— éœ€é…ç½®
    {
      errorMessage: 'æ·»åŠ AIé…ç½®å¤±è´¥',
      // autoConvertParams é»˜è®¤ä¸º falseï¼Œéµå¾ªæ¶æ„çº¦å®š
    }
  );
}
```

### ç¤ºä¾‹2ï¼šæ–‡ä»¶è§£æ

**ä¿®æ”¹å‰**ï¼š

```typescript
async parse(filePath: string) {
  return invoke<POEntry[]>(
    COMMANDS.PO_PARSE,
    { filePath },
    {
      errorMessage: 'è§£æ PO æ–‡ä»¶å¤±è´¥',
      autoConvertParams: false, // âŒ é‡å¤é…ç½®
    }
  );
}
```

**ä¿®æ”¹å**ï¼š

```typescript
async parse(filePath: string) {
  return invoke<POEntry[]>(
    COMMANDS.PO_PARSE,
    { filePath }, // âœ… å‚æ•°è‡ªåŠ¨ä¿æŒ camelCase
    {
      errorMessage: 'è§£æ PO æ–‡ä»¶å¤±è´¥',
    }
  );
}
```

### ç¤ºä¾‹3ï¼šåç«¯ç»“æ„ä½“

**ä¿®æ”¹å‰**ï¼š

```rust
// åç«¯è¿”å› snake_caseï¼Œå‰ç«¯æ”¶åˆ°ä¹Ÿæ˜¯ snake_case
#[derive(Serialize)]
pub struct AIConfig {
    pub api_key: String,  // âŒ JSON: "api_key"
    pub base_url: String, // âŒ JSON: "base_url"
}
```

**ä¿®æ”¹å**ï¼š

```rust
// åç«¯è‡ªåŠ¨è½¬æ¢ä¸º camelCase
#[derive(Serialize)]
#[serde(rename_all = "camelCase")] // âœ… ç»Ÿä¸€åºåˆ—åŒ–
pub struct AIConfig {
    pub api_key: String,  // âœ… JSON: "apiKey"
    pub base_url: String, // âœ… JSON: "baseUrl"
}
```

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘æ£€æŸ¥

```bash
âœ“ npm run build   - å‰ç«¯ç¼–è¯‘é€šè¿‡
âœ“ cargo check     - åç«¯ç¼–è¯‘é€šè¿‡
âœ“ æ— ç±»å‹é”™è¯¯
âœ“ æ— è­¦å‘Šï¼ˆé™¤chunkå¤§å°ä¼˜åŒ–å»ºè®®ï¼‰
```

### åŠŸèƒ½æµ‹è¯•

```bash
å¾…æµ‹è¯•ï¼ˆç”¨æˆ·å¯æ‰‹åŠ¨éªŒè¯ï¼‰ï¼š
- [ ] AIé…ç½®ä¿å­˜/ç¼–è¾‘
- [ ] POæ–‡ä»¶è§£æ/ä¿å­˜
- [ ] ç¿»è¯‘åŠŸèƒ½ï¼ˆå•æ¡/æ‰¹é‡ï¼‰
- [ ] æ–‡ä»¶æ ¼å¼æ£€æµ‹
- [ ] è¯­è¨€æ£€æµ‹
```

## ğŸ“ˆ é•¿æœŸå½±å“

### å‡å°‘æŠ€æœ¯å€ºåŠ¡

- ç§»é™¤ 18è¡Œå†—ä½™ä»£ç 
- ç»Ÿä¸€æ¶æ„è§„èŒƒ
- æé«˜ä»£ç è´¨é‡

### æå‡å¼€å‘æ•ˆç‡

- æ–°å¢å‘½ä»¤é›¶é…ç½®
- è‡ªåŠ¨éµå¾ªçº¦å®š
- å‡å°‘å‡ºé”™å¯èƒ½

### æ”¹å–„å¯ç»´æŠ¤æ€§

- å•ç‚¹ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ
- æ¶æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£
- æ–‡æ¡£å®Œå–„ï¼Œæ˜“äºonboarding

## ğŸ“ ç»éªŒæ€»ç»“

### è¯†åˆ«æ¨¡å¼

å½“åŒç±»é—®é¢˜åå¤å‡ºç°æ—¶ï¼ˆå¦‚å‚æ•°è½¬æ¢é”™è¯¯ï¼‰ï¼Œè¿™é€šå¸¸æ˜¯**æ¶æ„é—®é¢˜**è€Œé**ä¸ªåˆ«bug**ã€‚

### ç³»ç»Ÿæ€§è§£å†³

1. **æ‰¾æ ¹å› **ï¼šä¸ºä»€ä¹ˆéœ€è¦é‡å¤é…ç½®ï¼Ÿ
2. **æ”¹æ¶æ„**ï¼šèƒ½å¦ä¸€å¤„ä¿®æ”¹å…¨å±€ç”Ÿæ•ˆï¼Ÿ
3. **å»ºè§„èŒƒ**ï¼šå¦‚ä½•é˜²æ­¢æœªæ¥é‡å¤ï¼Ÿ
4. **å†™æ–‡æ¡£**ï¼šå¦‚ä½•ä¼ æ‰¿çŸ¥è¯†ï¼Ÿ

### é¿å…é™·é˜±

- âŒ è¢«åŠ¨ä¿®å¤ï¼šæ²»æ ‡ä¸æ²»æœ¬
- âŒ åˆ†æ•£é…ç½®ï¼šç»´æŠ¤å™©æ¢¦
- âŒ ç¼ºå°‘æ–‡æ¡£ï¼šçŸ¥è¯†æµå¤±

### æ­£ç¡®åšæ³•

- âœ… ä¸»åŠ¨é¢„é˜²ï¼šä»æ¶æ„å±‚é¢è§£å†³
- âœ… é›†ä¸­ç®¡ç†ï¼šå•ä¸€çœŸç›¸æº
- âœ… æ–‡æ¡£å…ˆè¡Œï¼šæ¶æ„å†³ç­–è®°å½•

## ğŸ“š å‚è€ƒæ–‡æ¡£

1. **æ¶æ„å†³ç­–**ï¼š`docs/ARCHITECTURE_DECISION_TAURI_PARAMS.md`
2. **è¯¦ç»†æ€»ç»“**ï¼š`specs/001-bug-7/ARCHITECTURE-IMPROVEMENT-SUMMARY.md`
3. **APIæ–‡æ¡£**ï¼š`docs/API.md`ï¼ˆå·²æ›´æ–°ï¼‰
4. **æ¶æ„æ–‡æ¡£**ï¼š`docs/Architecture.md`
5. **å˜æ›´æ—¥å¿—**ï¼š`docs/CHANGELOG.md`ï¼ˆå·²æ›´æ–°ï¼‰

## ğŸš€ åç»­å»ºè®®

1. **æ‰‹åŠ¨æµ‹è¯•**ï¼šéªŒè¯æ‰€æœ‰å…³é”®åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **ç›‘æ§æ—¥å¿—**ï¼šå…³æ³¨å‚æ•°æ ¼å¼ç›¸å…³çš„æ—¥å¿—
3. **æŒç»­æ”¹è¿›**ï¼šå‘ç°æ–°é—®é¢˜æ—¶ä¼˜å…ˆè€ƒè™‘æ¶æ„çº§è§£å†³
4. **çŸ¥è¯†ä¼ æ‰¿**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜ç†è§£æ–°çš„æ¶æ„çº¦å®š

---

**æ ¸å¿ƒç†å¿µ**ï¼š

> å¥½çš„æ¶æ„è®©æ­£ç¡®çš„äº‹æƒ…å®¹æ˜“åšï¼Œè®©é”™è¯¯çš„äº‹æƒ…éš¾åšã€‚

é€šè¿‡ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬è®©"ä½¿ç”¨camelCase"æˆä¸ºè‡ªç„¶è€Œç„¶çš„é€‰æ‹©ï¼Œè€Œä¸æ˜¯éœ€è¦è®°ä½çš„è§„åˆ™ã€‚
